/* =========================================
   全域與基礎版面設定
   ========================================= */
:root { 
    --primary-color: #b16837; 
    --bg-color: #f5f2e8; 
}

body { 
    font-family: 'Noto Sans TC', Arial, sans-serif; 
    margin: 0; 
    background: var(--bg-color); 
    overflow-x: hidden; 
}

.layout-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; position: relative; }

/* =========================================
   標題與導覽列
   ========================================= */
header { 
    width: 100%; background: #000; color: white; padding: 20px 0; 
    text-align: center; letter-spacing: 2px; position: relative; z-index: 10; 
}
header h1 { cursor: pointer; display: inline-block; transition: 0.3s; margin: 0; font-family: 'Playfair Display', serif; }
header h1:hover { opacity: 0.7; }

.city-nav { width: 90%; max-width: 1200px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding: 20px 0; z-index: 10; position: relative; }
.city-btn { padding: 10px 20px; border: 1px solid #ddd; background: white; cursor: pointer; transition: 0.3s; font-size: 14px; border-radius: 2px; font-weight: bold; }
.city-btn:hover, .city-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

/* =========================================
   主內容區塊 (資訊、側邊欄、地圖)
   ========================================= */
.container { 
    width: 95%; max-width: 1200px; background: white; padding: 30px; 
    border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 50px; 
    z-index: 10; position: relative; 
}
#city-info { margin-bottom: 20px; border-left: 4px solid var(--primary-color); padding-left: 20px; }
#city-title { margin: 0; font-size: 28px; font-family: 'Playfair Display', serif; color: #333; }
#city-desc { color: #666; margin-top: 10px; font-size: 14px; }

.main-content { display: flex; gap: 20px; height: 550px; align-items: stretch; }
#event-sidebar { flex: 1; max-width: 300px; display: flex; flex-direction: column; border: 1px solid #eee; border-radius: 4px; background: #fafafa; }
#event-list-header { padding: 12px; background: #222; color: #fff; font-size: 14px; font-weight: bold; text-align: center; letter-spacing: 1px; }
#event-container { flex: 1; overflow-y: auto; padding: 15px; }

.event-card { background: white; border: 1px solid #ddd; padding: 12px; margin-bottom: 12px; border-left: 4px solid var(--primary-color); cursor: pointer; transition: 0.2s; }
.event-card:hover { border-color: var(--primary-color); transform: translateX(5px); box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
.event-card.no-link { cursor: default; }
.event-card.no-link:hover { transform: none; box-shadow: none; border-color: #ddd;}
.event-name { font-weight: bold; font-size: 14px; margin-bottom: 6px; color: #333; line-height: 1.3; }
.event-date { font-size: 11px; color: #888; font-family: monospace; }

#map { flex: 3; height: 100%; border-radius: 4px; border: 1px solid #eee; min-height: 550px; z-index: 1; }

.custom-marker { width: 16px; height: 16px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.4); }
.marker-v0 { background-color: #9e9e9e; } 
.marker-v1 { background-color: #d48a5b; } 
.marker-v2 { background-color: #8b5a2b; } 

/* =========================================
   自訂地圖 Pop-up 樣式與排版矩陣
   ========================================= */
.custom-popup { width: 100%; text-align: left; font-family: 'Noto Sans TC', sans-serif; }
.custom-popup .popup-title { font-size: 18px; font-weight: bold; color: #8b5a2b; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 6px; font-family: 'Playfair Display', serif; line-height: 1.2; }
.custom-popup .popup-image { width: 100%; max-height: 160px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.custom-popup .popup-desc { font-size: 13px; color: #444; margin-bottom: 12px; line-height: 1.6; text-align: justify; }

.custom-popup .popup-wiki { float: right; color: #b16837; font-weight: bold; text-decoration: none; font-size: 12px; margin-left: 8px; margin-top: 2px; }
.custom-popup .popup-wiki:hover { text-decoration: underline; }
.custom-popup .popup-desc::after { content: ""; display: table; clear: both; }

.custom-popup .popup-detail { font-size: 12px; color: #555; margin-top: 6px; display: flex; align-items: flex-start; gap: 6px; line-height: 1.4; border-top: 1px dashed #f0f0f0; padding-top: 6px; }
.custom-popup .popup-detail a { color: #b16837; text-decoration: none; font-weight: bold; }
.custom-popup .popup-detail a:hover { text-decoration: underline; }

.price-grid { display: grid; grid-template-columns: auto 1fr; gap: 0 12px; width: 100%; }
.time-grid { display: grid; grid-template-columns: 32px 1fr; gap: 0 8px; width: 100%; }
.grid-label { color: #666; white-space: nowrap; }
.grid-price { color: #333; font-weight: bold; text-align: left; }
.grid-day { color: #666; font-weight: 500; }
.grid-time { color: #333; white-space: nowrap; }

.matrix-time-grid { display: grid; grid-template-columns: 32px 1fr 1fr; gap: 4px 10px; width: 100%; }
.matrix-price-grid-cat { display: grid; grid-template-columns: auto 1fr 1fr; gap: 4px 10px; width: 100%; }
.matrix-price-grid-nocat { display: grid; grid-template-columns: 1fr 1fr; gap: 4px 10px; width: 100%; }
.matrix-header { font-weight: bold; color: #b16837; font-size: 12px; border-bottom: 1px dashed #eee; padding-bottom: 4px; margin-bottom: 2px; }
.matrix-empty-header { border-bottom: 1px dashed #eee; margin-bottom: 2px; }

/* =========================================
   3D 飛梭畫廊與動態環境背景
   ========================================= */
#dark-mode-overlay {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: #0a0a0a;
    opacity: 0; pointer-events: none; z-index: 40;
    will-change: opacity;
}

#dynamic-blur-bg {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    pointer-events: none; z-index: 41; overflow: hidden;
}

.blur-bg-item {
    position: absolute; 
    top: 47.5%; left: 47.5%; width: 5%; height: 5%; 
    object-fit: cover;
    transform: scale(24) translateZ(0); 
    filter: blur(1.2px) brightness(0.4) saturate(1.4); 
    opacity: 0; visibility: hidden; 
    will-change: opacity, visibility;
}

#trip-notes-wrapper { width: 100%; position: relative; display: none; z-index: 50; }

#trip-notes-pinned { 
    height: 100vh; width: 100vw; position: relative; overflow: hidden; 
    display: flex; align-items: center; justify-content: center; 
    left: calc(-50vw + 50%);
    perspective: 1500px; 
    transform-style: preserve-3d;
    pointer-events: none; 
}

#trip-notes-container {
    width: 100%; height: 100%; position: absolute; top: 0; left: 0;
    transform-style: preserve-3d;
}

.note-card-fly { 
    position: absolute; top: 50%; left: 50%; width: 280px; 
    display: flex; flex-direction: column; align-items: center; 
    opacity: 0; visibility: hidden; 
    color: #ffffff; 
    will-change: transform, opacity, visibility; 
    transform-style: preserve-3d;
    pointer-events: none; 
}

.note-card-fly .title { 
    width: 100%; font-size: 26px; font-family: 'Playfair Display', serif; font-style: italic;
    text-align: center; margin-bottom: 20px; color: #e6a77e; 
    text-shadow: 0 4px 15px rgba(0,0,0,0.9); line-height: 1.2; letter-spacing: 1px;
}

.note-card-fly .texts-wrapper { 
    width: 100%; margin-top: 70px; text-align: center; position: relative; z-index: 10; 
    pointer-events: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 50px; 
}

.date-item {
    font-size: 15px; font-family: monospace; color: #e6a77e; letter-spacing: 1px; font-weight: bold;
    transition: all 0.3s ease; opacity: 1; position: relative; visibility: visible;
}

.text-item { 
    font-size: 13px; line-height: 1.7; margin: 0; text-shadow: 0 2px 8px rgba(0,0,0,1); color: #ffffff; 
    transition: all 0.3s ease; will-change: opacity, transform;
    opacity: 0; visibility: hidden; position: absolute; transform: translateY(10px);
}

.photo-fan { 
    position: relative; width: 100%; aspect-ratio: 4/5; perspective: 1000px; cursor: pointer; 
    pointer-events: auto; 
}
.fan-item { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1), filter 0.3s ease; 
    transform-origin: center bottom; border: 4px solid #1a1a1a; border-radius: 4px; 
    box-shadow: 0 20px 40px rgba(0,0,0,0.9); background: #000; overflow: hidden; 
}
.fan-item img, .fan-item video { 
    width: 100%; height: 100%; object-fit: cover; opacity: 1; 
    transition: transform 0.3s; transform: translateZ(0); will-change: transform;
}
.photo-fan:hover .fan-item img, .photo-fan:hover .fan-item video { transform: scale(1.05); }

/* =========================================
   全域懸浮 UI 終極版 
   ========================================= */
#global-floating-ui {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    pointer-events: none; 
    z-index: 999999; 
}

/* Home 按鈕：左上角 */
.home-btn { 
    position: absolute; left: 30px; top: 20px; /* 這裡從 20px 改成 30px */
    color: #fff !important; text-decoration: none; 
    border: 1px solid rgba(255, 255, 255, 0.6) !important; 
    padding: 8px 22px; font-size: 14px; transition: 0.3s; 
    background: rgba(255, 255, 255, 0.15) !important; 
    border-radius: 30px; 
    font-family: 'Playfair Display', serif; font-style: italic; letter-spacing: 1px;
    backdrop-filter: blur(8px); pointer-events: auto !important; 
    text-shadow: 0 1px 4px rgba(0,0,0,0.8);
}
.home-btn:hover { background: var(--primary-color) !important; border-color: var(--primary-color) !important; }

/* 景點清單按鈕：右上角 */
#attraction-list-btn {
    position: absolute; right: 30px; top: 20px; /* 這裡從 20px 改成 30px */
    color: #fff; border: 1px solid rgba(255, 255, 255, 0.6); 
    padding: 8px 22px; font-size: 14px; transition: 0.3s; 
    background: rgba(255, 255, 255, 0.15); 
    border-radius: 30px; 
    font-family: 'Playfair Display', serif; font-style: italic; letter-spacing: 1px;
    backdrop-filter: blur(8px); cursor: pointer; pointer-events: auto; 
    text-shadow: 0 1px 4px rgba(0,0,0,0.8);
    opacity: 0; visibility: hidden; transform: translateY(-20px);
}
#attraction-list-btn.show { opacity: 1; visibility: visible; transform: translateY(0); }
#attraction-list-btn:hover { background: var(--primary-color); border-color: var(--primary-color); }

/* 景點清單展開面板 */
#attraction-list-panel {
    position: absolute; top: 70px; right: 30px; width: 280px; /* right 從 20px 改成 30px */
    max-height: 70vh; overflow-y: auto;
    background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px;
    padding: 10px 0; pointer-events: none;
    opacity: 0; visibility: hidden; transform: translateX(20px);
    transition: 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
#attraction-list-panel.open { opacity: 1; visibility: visible; transform: translateX(0); pointer-events: auto; }

/* 客製化優雅捲動條 */
#attraction-list-panel::-webkit-scrollbar { width: 6px; }
#attraction-list-panel::-webkit-scrollbar-track { background: transparent; }
#attraction-list-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
#attraction-list-panel::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }

/* 清單項目 */
.attraction-item {
    padding: 14px 20px; color: #f4f4f4; font-size: 13px; cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.08); transition: 0.2s; 
    font-family: 'Playfair Display', serif; font-style: italic; letter-spacing: 0.5px;
}
.attraction-item:hover { background: rgba(177, 104, 55, 0.6); padding-left: 28px; color: #fff; }
.attraction-item:last-child { border-bottom: none; }

/* 百分比 */
#scroll-percentage {
    position: absolute; bottom: 30px; left: 30px; 
    font-family: 'Playfair Display', serif; font-style: italic;
    font-size: 28px; color: rgba(255, 255, 255, 0.95);
    text-shadow: 0 2px 8px rgba(0,0,0,1), 0 0 20px rgba(0,0,0,0.8); 
    pointer-events: none; opacity: 0; visibility: hidden; transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1);
}

/* 位置指示器 */
#location-indicator {
    position: absolute; bottom: 30px; left: 50%; 
    text-align: center; pointer-events: none;
    text-shadow: 0 2px 10px rgba(0,0,0,1), 0 0 25px rgba(0,0,0,0.8);
    opacity: 0; visibility: hidden; transform: translate(-50%, 30px);
    transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1);
}
#loc-country { font-size: 16px; color: #e6a77e; letter-spacing: 6px; text-transform: uppercase; margin-bottom: -2px; font-weight: bold; }
#loc-city { font-size: 46px; color: #ffffff; font-family: 'Playfair Display', serif; font-style: italic; letter-spacing: 2px; line-height: 1.1; }

/* 回到頂端 */
#scroll-to-top {
    position: absolute; bottom: 30px; right: 30px; 
    background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.5);
    width: 48px; height: 48px; border-radius: 50%; cursor: pointer;
    font-weight: bold; font-size: 20px; backdrop-filter: blur(8px); 
    display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    opacity: 0; visibility: hidden; transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); pointer-events: auto !important; 
}
#scroll-to-top:hover { background: var(--primary-color); border-color: var(--primary-color); transform: translateY(-4px); }

/* --- 進入畫廊時觸發的 show 動畫 --- */
#scroll-percentage.show, #scroll-to-top.show { opacity: 1 !important; visibility: visible !important; transform: translateY(0) !important; }
#location-indicator.show { opacity: 1 !important; visibility: visible !important; transform: translate(-50%, 0) !important; }

/* =========================================
   RWD 手機版響應式設計 (小於 768px)
   ========================================= */
/* =========================================
   RWD 手機版響應式設計 (小於 768px)
   ========================================= */
@media (max-width: 768px) {
    .main-content { flex-direction: column; height: auto; }
    #map { order: 1; flex: none; width: 100%; height: 450px; min-height: 450px; }
    
    /* 1. 修正 Travel Log：取消固定高度，改為隨內容長高，並設定最大高度讓它事件過多時可滾動 */
    #event-sidebar { 
        order: 2; flex: none; max-width: 100%; width: 100%; 
        height: auto; 
        max-height: 450px; 
    }
    
    /* 讓整個白色卡片底部留點空間，避免滑到最底時太擠 */
    .container { width: 100%; padding: 15px; box-sizing: border-box; margin-bottom: 100px; }

    /* 2. 懸浮 UI 微調：增加與螢幕邊緣的距離 (從 15px 加大到 25px/35px) */
    .home-btn { top: 25px; left: 25px; padding: 7px 18px; font-size: 13px; }
    #attraction-list-btn { top: 25px; right: 25px; padding: 7px 18px; font-size: 13px; }
    
    /* 清單面板也要跟著按鈕退縮，並調整寬度避免爆框 */
    #attraction-list-panel { top: 70px; right: 25px; width: calc(100vw - 50px); max-height: 60vh; }
    
    /* 底部資訊微調 */
    #location-indicator { bottom: 35px; }
    #loc-country { font-size: 12px; letter-spacing: 4px; }
    #loc-city { font-size: 32px; }
    
    /* 讓回到頂端與百分比遠離底部邊緣 */
    #scroll-to-top { bottom: 35px; right: 25px; width: 44px; height: 44px; font-size: 18px; }
    #scroll-percentage { bottom: 35px; left: 25px; font-size: 24px; }
}